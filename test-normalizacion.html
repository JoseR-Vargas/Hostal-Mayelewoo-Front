<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Normalizaci√≥n de Mediciones</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }
        .test-case {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            border-radius: 4px;
        }
        .test-case.error {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        .input-value {
            font-weight: bold;
            color: #007bff;
        }
        .output-value {
            font-weight: bold;
            color: #28a745;
        }
        .expected-value {
            font-weight: bold;
            color: #666;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .summary {
            margin-top: 30px;
            padding: 20px;
            background: #e7f3ff;
            border-radius: 5px;
            font-size: 18px;
        }
        .pass {
            color: #28a745;
            font-weight: bold;
        }
        .fail {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test de Normalizaci√≥n de Mediciones</h1>
        <p>Esta prueba verifica que los n√∫meros enteros se conviertan autom√°ticamente al formato decimal correcto.</p>
        
        <div id="results"></div>
        <div id="summary" class="summary"></div>
        
        <button onclick="runTests()">‚ñ∂Ô∏è Ejecutar Pruebas</button>
        <button onclick="location.href='calculator-medidor.html'">üìä Ir a Calculadora</button>
    </div>

    <script>
        // Funci√≥n normalizeMeasurement (copiada de calculator-medidor.js)
        function normalizeMeasurement(value) {
            if (!value) return value;
            
            // Limpiar espacios
            value = value.trim();
            
            // Si ya tiene punto o coma, solo reemplazar coma por punto
            if (value.includes('.') || value.includes(',')) {
                return value.replace(',', '.');
            }
            
            // Si es un n√∫mero entero sin separador decimal
            // Insertar el punto antes del √∫ltimo d√≠gito
            if (/^\d+$/.test(value) && value.length > 1) {
                // Insertar punto antes del √∫ltimo d√≠gito
                const insertPosition = value.length - 1;
                const normalized = value.slice(0, insertPosition) + '.' + value.slice(insertPosition);
                return normalized;
            }
            
            return value;
        }

        // Casos de prueba
        const testCases = [
            { input: "35659", expected: "3565.9", description: "Entero sin punto ‚Üí agrega punto decimal" },
            { input: "38773", expected: "3877.3", description: "Entero sin punto ‚Üí agrega punto decimal" },
            { input: "3565.9", expected: "3565.9", description: "Ya tiene punto ‚Üí sin cambios" },
            { input: "3565,9", expected: "3565.9", description: "Tiene coma ‚Üí cambia a punto" },
            { input: "003625", expected: "00362.5", description: "Con ceros a la izquierda" },
            { input: "12345", expected: "1234.5", description: "5 d√≠gitos" },
            { input: "1234567", expected: "123456.7", description: "7 d√≠gitos" },
            { input: "100", expected: "10.0", description: "Tres d√≠gitos" },
            { input: "3625.25", expected: "3625.25", description: "Ya tiene decimales ‚Üí sin cambios" },
            { input: "4000,5", expected: "4000.5", description: "Con coma ‚Üí cambia a punto" },
            { input: "  35659  ", expected: "3565.9", description: "Con espacios ‚Üí limpia y normaliza" }
        ];

        function runTests() {
            const resultsDiv = document.getElementById('results');
            const summaryDiv = document.getElementById('summary');
            resultsDiv.innerHTML = '';
            
            let passed = 0;
            let failed = 0;

            testCases.forEach((testCase, index) => {
                const result = normalizeMeasurement(testCase.input);
                const isPass = result === testCase.expected;
                
                if (isPass) {
                    passed++;
                } else {
                    failed++;
                }

                const testDiv = document.createElement('div');
                testDiv.className = `test-case ${isPass ? '' : 'error'}`;
                testDiv.innerHTML = `
                    <strong>Test ${index + 1}:</strong> ${testCase.description}<br>
                    <span class="input-value">Entrada:</span> "${testCase.input}"<br>
                    <span class="output-value">Resultado:</span> "${result}"<br>
                    <span class="expected-value">Esperado:</span> "${testCase.expected}"<br>
                    <strong>${isPass ? '‚úÖ PASS' : '‚ùå FAIL'}</strong>
                `;
                resultsDiv.appendChild(testDiv);
            });

            // Mostrar resumen
            const total = testCases.length;
            summaryDiv.innerHTML = `
                <strong>Resumen de Pruebas:</strong><br>
                Total: ${total} | 
                <span class="pass">‚úÖ Pasadas: ${passed}</span> | 
                <span class="fail">‚ùå Fallidas: ${failed}</span><br>
                <strong>Tasa de √©xito: ${((passed/total)*100).toFixed(1)}%</strong>
            `;
        }

        // Ejecutar pruebas autom√°ticamente al cargar
        window.onload = runTests;
    </script>
</body>
</html>
